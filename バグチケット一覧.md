# バグチケット一覧

探索的テストで発見された意図的でないバグのチケット一覧です。

---

## 🔴 BUG-001: 商品新規登録フォームが送信できない【重大】

**優先度**: P0 (緊急)  
**重要度**: 高  
**ステータス**: 未対応  
**発見日**: 2025-11-06  
**影響範囲**: 商品登録機能全体

### 概要
商品新規登録フォームで全項目を入力しても、「登録」ボタンをクリックしてもフォームが送信されず、商品を登録できない。

### 再現手順
1. 管理者アカウントでログイン
2. ナビゲーションの「新規登録」をクリック
3. 以下を入力：
   - 商品名: `テスト商品`
   - カテゴリ: `書籍`
   - 価格: `1000`
   - 在庫数: `10`
4. 「登録」ボタンをクリック

### 期待結果
- 商品が登録される
- 「商品を登録しました。」メッセージが表示される
- 商品一覧ページにリダイレクトされる

### 実際の結果
- フォームが送信されない
- 同じページに留まる
- 商品は登録されない

### 原因
`templates/product_form.html` 88行目のステータスラジオボタンに `disabled` 属性が設定されており、フォーム送信時に値が含まれないため。

```html
<input type="radio" 
       id="status_preparing" 
       name="status" 
       value="準備中" 
       checked
       disabled>  <!-- ← 問題箇所 -->
```

### 修正案
**方法1: hidden input追加（推奨）**
```html
<div>
    <input type="radio" 
           id="status_preparing_display" 
           value="準備中" 
           checked
           disabled>
    <input type="hidden" 
           name="status" 
           value="準備中">
    <label for="status_preparing_display" style="display: inline; font-weight: normal;">
        準備中（新規登録時は固定）
    </label>
</div>
```

### 影響
- システムの基幹機能が使用不可
- 通常の操作では商品を一切追加できない
- ビジネスへの直接的影響が大きい

### 回避策
開発者ツールで以下を実行：
```javascript
document.querySelector('input[name="status"]').disabled = false;
```

### 推定工数
0.5時間

---

## 🟡 BUG-002: 検索フォームで負の価格値が受け入れられる

**優先度**: P1  
**重要度**: 中  
**ステータス**: 未対応  
**発見日**: 2025-11-06  
**影響範囲**: 商品検索機能

### 概要
商品検索フォームの「価格（下限）」フィールドに負の値（例: `-1`）を入力しても、エラーなく検索が実行される。

### 再現手順
1. 商品一覧ページにアクセス
2. 「価格（下限）」に `-1` を入力
3. 「検索」ボタンをクリック

### 期待結果
- 負の値は受け入れない
- エラーメッセージを表示する
- または入力を拒否する

### 実際の結果
- 検索が実行される
- 全ての商品が表示される（`price >= -1` は常に真）

### 原因
1. HTMLフォームに `min="0"` 属性が設定されていない
2. バックエンドで負の値のバリデーションが実装されていない

### 修正案
**フロントエンド**: `templates/products_list.html` 38-43行目
```html
<input type="number" 
       id="price_min" 
       name="price_min" 
       data-testid="search-price-min"
       value="{{ request.args.get('price_min', '') }}"
       min="0"
       placeholder="例: 1000">
```

**バックエンド**: `app.py` 検索処理部分に追加
```python
if price_min and int(price_min) < 0:
    flash('価格は0円以上で指定してください。', 'error')
    return redirect(url_for('products_list'))
```

### 影響
- UX（ユーザー体験）の低下
- ユーザーの混乱

### 推定工数
1時間

---

## 🟡 BUG-003: 検索で price_min > price_max が許可される

**優先度**: P1  
**重要度**: 中  
**ステータス**: 未対応  
**発見日**: 2025-11-06  
**影響範囲**: 商品検索機能

### 概要
価格下限が上限より大きい値を入力しても、エラーメッセージなく検索が実行され、常に0件の結果となる。

### 再現手順
1. 商品一覧ページにアクセス
2. 「価格（下限）」に `100`、「価格（上限）」に `50` を入力
3. 「検索」ボタンをクリック

### 期待結果
- エラーメッセージを表示する
- または値を自動的に入れ替える
- 論理的に不正な入力であることを警告する

### 実際の結果
- 検索が実行される
- 結果は常に0件（`price >= 100 AND price <= 50` は常に偽）
- エラーメッセージは表示されない

### 原因
バックエンドで価格範囲の論理的整合性チェックが実装されていない。

### 修正案
`app.py` の `products_list` 関数に追加：
```python
if price_min and price_max:
    if int(price_min) > int(price_max):
        flash('価格の下限は上限以下である必要があります。', 'error')
        return redirect(url_for('products_list'))
```

または、JavaScriptでリアルタイムバリデーション：
```javascript
document.querySelector('#price_min').addEventListener('change', function() {
    const min = parseInt(this.value);
    const max = parseInt(document.querySelector('#price_max').value);
    if (max && min > max) {
        alert('価格の下限は上限以下である必要があります。');
        this.value = '';
    }
});
```

### 影響
- ユーザーが意図しない検索結果を得る
- サポート問い合わせの増加
- UXの低下

### 推定工数
1時間

---

## テスト済み・正常動作を確認した機能

以下は詳細にテストし、正常に動作することを確認しました：

✅ ログイン認証（SQLインジェクション対策済み）  
✅ 権限制御（admin/userの適切な分離）  
✅ セッション管理  
✅ 在庫ステータス表示  
✅ 商品編集時のバリデーション  
✅ 存在しない商品へのアクセス時のエラーハンドリング  
✅ ステータス遷移ルールのUI実装  

---

## 対応スケジュール（推奨）

| チケット | 優先度 | 期限 | 推定工数 |
|---------|-------|------|----------|
| BUG-001 | P0 | 即座 | 0.5時間 |
| BUG-002 | P1 | 1週間以内 | 1時間 |
| BUG-003 | P1 | 1週間以内 | 1時間 |

**合計推定工数**: 2.5時間

---

**最終更新**: 2025-11-06  
**次回確認**: Bug修正後の回帰テスト実施
