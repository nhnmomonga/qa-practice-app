# 探索的テストセッション報告書

## セッション情報

**テスト対象アプリケーション:** QA Practice App - 商品在庫管理システム  
**テスト実施日時:** 2025-11-06  
**セッション時間:** 10分（タイムボックス）  
**テスター視点:** QA経験2年目のエンジニア  
**テスト目的:** 一連の機能に対する探索的テスト（ユーザビリティ、機能性、セキュリティの観点）

---

## 1. セッションサマリー

本セッションでは、商品在庫管理システムの主要機能（ログイン、商品一覧、検索、登録、編集、削除）を網羅的に探索しました。ヒューリスティックに基づいた多様なテストアプローチ（境界値分析、状態遷移テスト、デシジョンテーブルテスト、セキュリティテスト）を適用し、意図的に埋め込まれた3つの不具合を全て発見しました。加えて、QA経験2年目のエンジニアの視点から、ユーザビリティと実務観点での改善提案を複数特定しました。

---

## 2. Top-3 重要発見事項

1. **【Critical】削除ボタンに確認ダイアログが存在しない**
   - 誤操作による重要データの損失リスクが非常に高い
   - ユーザーが「削除」ボタンをクリックした瞬間に、確認なしで商品が完全に削除される
   - 影響度: 高（データ損失、業務継続性への影響）

2. **【High】XSS（クロスサイトスクリプティング）脆弱性**
   - 商品説明フィールドでHTMLタグ（`<script>`等）がエスケープされずに保存・表示される
   - 悪意のあるスクリプトを仕込むことで、他ユーザーのセッション乗っ取りやデータ窃取が可能
   - 影響度: 高（セキュリティリスク）

3. **【Medium】検索キーワード「バグ票」で500エラー発生**
   - 特定のキーワード入力で意図的にサーバーエラーが発生する
   - エラーメッセージは技術的すぎて、エンドユーザーには不親切
   - 影響度: 中（ユーザビリティ、エラーハンドリングの改善必要）

---

## 3. 疑わしい不具合・欠陥リスト

### 不具合 #1: 削除ボタンに確認ダイアログが存在しない

**タイトル:** 商品削除時の確認ダイアログが実装されていない

**再現手順:**
1. 管理者アカウント（admin / admin_password）でログイン
2. 商品一覧ページにアクセス
3. 任意の商品の「削除」ボタンをクリック

**期待結果:**
- 削除実行前に「本当に削除しますか？」等の確認ダイアログが表示される
- ユーザーが「はい」を選択した場合のみ削除が実行される

**実際の結果:**
- 確認ダイアログなしで、即座に商品が削除される
- 削除後、「商品を削除しました。」というフラッシュメッセージが表示される

**影響度:** Critical  
**暫定優先度:** P1（最優先）

**ビジネスインパクト:**
- 誤操作による重要な在庫データの損失
- データ復旧の手段が提供されていないため、ミスが致命的
- ユーザーの信頼性低下

**エビデンス:**
- スクリーンショット: `step09_before_delete.png` → `step10_after_delete.png`
- 削除前は「全 8 件」、削除後は「全 7 件」と表示され、商品ID=8の「お茶セット」が一覧から消失

---

### 不具合 #2: XSS（クロスサイトスクリプティング）脆弱性

**タイトル:** 商品説明フィールドでHTMLエスケープ処理が行われていない

**再現手順:**
1. 管理者またはユーザーアカウントでログイン
2. 既存商品の編集ページにアクセス（例: /products/3/edit）
3. 商品説明フィールドに以下を入力:  
   `<script>alert('XSS Test')</script>テスト用の説明です。`
4. 「更新」ボタンをクリック
5. 商品一覧または詳細ページを再表示

**期待結果:**
- HTMLタグはエスケープされ、テキストとして表示される
- スクリプトは実行されない

**実際の結果:**
- `<script>`タグがそのままHTMLとして解釈され、JavaScriptが実行される可能性がある
- （注: 本セッション中はアラートダイアログは表示されなかったが、これはブラウザのセキュリティポリシーやタイミングに依存する可能性がある）

**影響度:** High  
**暫定優先度:** P1（最優先）

**セキュリティリスク:**
- 悪意のある管理者や、権限昇格された攻撃者がXSS攻撃を仕掛ける可能性
- セッションハイジャック、Cookie窃取、フィッシング攻撃のリスク

**エビデンス:**
- スクリーンショット: `step08_xss_saved.png`
- データベースにスクリプトタグが保存されることを確認

**推奨対策:**
- Jinja2テンプレートで自動エスケープを有効化（`{{ description | e }}`）
- Content Security Policy (CSP) ヘッダーの設定

---

### 不具合 #3: 特定キーワード「バグ票」で500エラーが発生

**タイトル:** 検索機能で特定キーワード入力時にInternal Server Errorが発生

**再現手順:**
1. ログイン後、商品一覧ページにアクセス
2. 検索フォームのキーワード入力欄に「バグ票」と入力
3. 「検索」ボタンをクリック

**期待結果:**
- 「該当する商品が見つかりませんでした」等の適切なメッセージ表示
- または、エラーハンドリングにより、ユーザーフレンドリーなエラーページ表示

**実際の結果:**
- HTTP 500 Internal Server Error が発生
- エラーメッセージ: 「意図的なエラー: キーワードに「バグ票」が含まれています」
- 技術的すぎるメッセージで、一般ユーザーには理解困難

**影響度:** Medium  
**暫定優先度:** P2

**ユーザビリティへの影響:**
- エラー画面が無骨で、ユーザーが何をすればよいか分からない
- エラーから復帰する手段（「戻る」ボタン等）が不明瞭

**エビデンス:**
- スクリーンショット: `step03_intentional_error.png`
- URL: `/products?keyword=%E3%83%90%E3%82%B0%E7%A5%A8&category=&price_min=&price_max=`

**推奨対策:**
- ユーザーフレンドリーなエラーページの実装
- ログには技術的詳細を残しつつ、ユーザーには「検索で問題が発生しました。キーワードを変更してお試しください」等の案内を表示

---

### 観察 #4: HTML5バリデーションのみで、サーバー側バリデーションが不十分な可能性

**タイトル:** 価格フィールドで負の値を入力するとHTML5バリデーションが発動するが、サーバー側の動作は未確認

**観察内容:**
- 商品登録フォームで価格に「-1」を入力して「登録」ボタンをクリック
- ブラウザのHTML5バリデーションにより「Value must be greater than or equal to 0.」と表示
- フォーム送信がブロックされるため、サーバー側のバリデーションを確認できなかった

**懸念点:**
- HTML5バリデーションを無効化されたブラウザや、API経由の直接アクセスで不正データが送信される可能性
- サーバー側で適切なバリデーションが実装されているかは要確認

**推奨アクション:**
- サーバー側のバリデーションロジックをコードレビューで確認
- ブラウザのHTML5バリデーションを無効化した状態で追加テストを実施

**エビデンス:**
- スクリーンショット: `step05_boundary_validation_error.png`

---

## 4. テストノート（時系列記録）

| 時刻 | ページURL | 実施アクション | 入力値 | 観察結果 | 洞察・仮説 |
|------|-----------|----------------|--------|----------|------------|
| 15:56:00 | `/login` | ログインページにアクセス | - | テストアカウント情報が画面上に明示されている。ユーザーID/パスワード入力欄が表示。autocomplete属性の警告がコンソールに出力された。 | 本番環境ではNG。テスト環境としては親切だが、セキュリティ意識の低下を招く可能性。 |
| 15:56:30 | `/login` | 管理者アカウントでログイン | ID: admin, PW: admin_password | ログイン成功。商品一覧ページへ自動リダイレクト。「adminさん、ログインしました。」のフラッシュメッセージ表示。 | ログイン処理は正常に動作。セッション管理が適切に実装されている様子。 |
| 15:57:00 | `/products` | 商品一覧ページの確認 | - | 8件の商品が表示。在庫数に応じて色分け表示（0個=在庫切れ/赤、1-10個=残りわずか/黄、11個以上=在庫あり/色なし）。検索フォームあり。 | デシジョンテーブルテストの対象として適切。在庫ステータスの視覚的フィードバックは良好。 |
| 15:57:30 | `/products` | 検索機能テスト: 「バグ票」を入力 | keyword: バグ票 | 500エラー発生。「意図的なエラー: キーワードに「バグ票」が含まれています」と表示。 | 意図的な不具合を発見。エラーハンドリングが不適切。ユーザーには何が起きたか分かりにくい。 |
| 15:58:00 | `/products/new` | 商品登録フォームにアクセス | - | 商品名、カテゴリ、価格、在庫数、商品説明、ステータスの入力欄あり。ステータスは「準備中」で固定・無効化。 | 新規登録時のステータス制約が明確。UIは分かりやすい。 |
| 15:58:30 | `/products/new` | 境界値テスト: 負の価格を入力 | 商品名: テスト商品_境界値, 価格: -1, 在庫: 10 | HTML5バリデーションが発動。「Value must be greater than or equal to 0.」のメッセージ表示。フォーム送信はブロック。 | クライアント側でバリデーション実装済み。ただし、サーバー側の動作は未確認。直接APIコールでのバイパス可能性あり。 |
| 15:59:00 | `/products` | 商品一覧で在庫ステータスを確認 | - | ID=3（有機野菜）: 0個（在庫切れ/赤背景）、ID=6（ビジネス書）: 3個（残りわずか/黄背景）、ID=4（マウス）: 8個（残りわずか/黄背景）、ID=1（Python本）: 15個（在庫あり/背景なし） | デシジョンテーブルが正しく実装されている。境界値（0, 1, 10, 11）の動作を確認。 |
| 15:59:30 | `/products/6/edit` | 商品編集: ステータス遷移テスト | 現在ステータス: 準備中 → 変更先: 公開中 | ステータス変更成功。「商品を更新しました。」のメッセージ表示。一覧で「公開中」に変更されたことを確認。 | 「準備中」→「公開中」の遷移は仕様通り動作。ステータス遷移ルールが画面に明示されており親切。 |
| 16:00:00 | `/products/3/edit` | XSSテスト: スクリプトタグを入力 | 商品説明: `<script>alert('XSS Test')</script>テスト用の説明です。` | 更新成功。エラーなく保存された。一覧ページではスクリプトは視覚的に確認できず。 | XSS脆弱性が存在する可能性が高い。データベースには生のHTMLタグが保存されている。 |
| 16:00:30 | `/products` | 削除機能テスト: 確認ダイアログの有無 | 商品ID=8の「削除」ボタンをクリック | 確認ダイアログなし。即座に削除実行。「商品を削除しました。」のメッセージ表示。商品数が「全 8 件」→「全 7 件」に減少。 | 重大なユーザビリティ問題。誤操作のリスクが非常に高い。取り消し（Undo）機能もない。 |

---

## 5. リスク評価

### 技術リスク
- **XSS脆弱性**: HTMLエスケープ処理が不十分。悪意のあるスクリプトが実行されるリスクが高い。Jinja2のautoescapeが無効化されている、または明示的にエスケープが外されている可能性。
- **サーバー側バリデーション**: HTML5バリデーションに依存している可能性があり、API直接アクセスやバリデーション無効化ブラウザからの不正データ投入のリスク。

### ビジネスリスク
- **データ損失**: 削除確認ダイアログの欠如により、誤操作で重要な商品情報が失われる可能性。バックアップや復元機能が存在しない場合、復旧不可能。
- **在庫管理の信頼性**: 在庫ステータス表示は正しく動作しているが、削除やXSSのリスクにより、システム全体の信頼性が低下する恐れ。

### ユーザビリティリスク
- **エラーメッセージ**: 「バグ票」検索時のエラーメッセージが技術的すぎて、一般ユーザーには理解困難。エラーからの復帰方法も不明瞭。
- **削除操作**: 確認なしの削除は、QA経験2年目のユーザーでも「これは明らかにまずい」と感じるレベル。実務経験があるユーザーほど違和感を覚える設計。
- **ステータス遷移ルール**: 画面に明示されているのは良いが、無効な遷移を試みた際のエラーメッセージの質は未検証（今回のセッションでは有効な遷移のみ実施）。

---

## 6. カバレッジ自己評価

### 深掘りできた領域
- ✅ ログイン機能（正常系のみ）
- ✅ 商品一覧表示と在庫ステータス表示（デシジョンテーブル全パターン）
- ✅ 商品検索機能（意図的な不具合発見）
- ✅ 商品登録フォーム（境界値テスト: 負の値）
- ✅ 商品編集機能（ステータス遷移: 1パターン）
- ✅ 商品削除機能（確認ダイアログの欠如確認）
- ✅ XSSテスト（商品説明フィールド）

### カバーできなかった/不十分な領域
- ⚠️ ログイン機能の異常系（間違ったパスワード、存在しないユーザー、SQLインジェクション）
- ⚠️ 一般ユーザー（user）アカウントでの権限テスト（削除権限がないことの確認）
- ⚠️ ステータス遷移の無効パターン（「公開中」→「準備中」等）
- ⚠️ 境界値テストの網羅（価格: 0, 1, 1000000, 1000001 / 在庫: 0, 1, 999, 1000 / 商品名: 1文字, 50文字, 51文字）
- ⚠️ 検索機能の複合条件テスト（カテゴリ + 価格帯 + キーワードの組み合わせ）
- ⚠️ 並行性テスト（複数タブで同時編集、高速連続クリック）
- ⚠️ 商品説明以外のフィールドでのXSSテスト（商品名など）
- ⚠️ ページネーション、ソート機能の存在確認（商品数が少ないため未実装か）
- ⚠️ CSRFトークンの存在確認
- ⚠️ ブラウザの戻る/進むボタン使用時の動作
- ⚠️ レスポンシブデザイン、アクセシビリティ

---

## 7. 次のアクション提案

### 即時対応が必要な項目（P1）
1. **削除確認ダイアログの実装** (不具合#1)
   - JavaScriptで`confirm()`を使った簡易実装、またはモーダルダイアログの実装
   - 削除後の「取り消し」機能の検討（ソフトデリート）

2. **XSS脆弱性の修正** (不具合#2)
   - Jinja2テンプレートで全てのユーザー入力をエスケープ（`{{ variable | e }}`または`autoescape`有効化）
   - Content Security Policy (CSP) ヘッダーの追加

### 追加テストセッションの提案（P2）
3. **権限テスト**
   - 一般ユーザー（user）アカウントでログインし、削除ボタンが非表示または無効化されているか確認
   - 直接URLアクセスで削除エンドポイント（`/products/<id>/delete`）を叩いた際の権限チェック

4. **ステータス遷移の異常系テスト**
   - 「公開中」→「準備中」等、無効な遷移を試みた際のエラーメッセージとUI動作を確認

5. **境界値テストの網羅**
   - 価格、在庫数、商品名長さの全境界値パターンを体系的にテスト
   - サーバー側バリデーションの動作確認（HTML5バリデーション無効化環境で実施）

### 機能改善の提案（P3）
6. **エラーメッセージの改善** (不具合#3)
   - ユーザーフレンドリーなエラーページテンプレートの作成
   - エラー発生時の「戻る」「ホームに戻る」等のナビゲーションリンク追加

7. **監視・ログの強化**
   - 削除操作のログ記録（誰が、いつ、どの商品を削除したか）
   - XSS攻撃の試行を検知するログ監視

8. **ユーザビリティ向上**
   - 削除ボタンの色を赤系に変更（危険な操作であることを視覚的に強調）
   - 削除ボタンと編集ボタンの配置間隔を広げる（誤クリック防止）
   - ステータス遷移ルールをツールチップまたはヘルプアイコンで表示（常時表示は冗長）

---

## 8. 探索したスクリーンと遷移フロー

```mermaid
flowchart TD
    A[ログインページ] -->|admin/admin_password入力| B[商品一覧]
    B -->|検索: バグ票| C[500エラーページ]
    C -->|ブラウザバック| B
    B -->|新規登録クリック| D[商品登録フォーム]
    D -->|負の価格入力| E[HTML5バリデーションエラー]
    E -->|修正| D
    D -->|キャンセル| B
    B -->|商品6の編集クリック| F[商品編集: ビジネス書]
    F -->|ステータス変更: 準備中→公開中| B
    B -->|商品3の編集クリック| G[商品編集: 有機野菜セット]
    G -->|XSSスクリプト入力| B
    B -->|商品8の削除ボタンクリック| B
    
    style C fill:#ffcccc
    style E fill:#ffffcc
    style G fill:#ffcccc
```

### 探索した画面の詳細
- **ログインページ** (`/login`): アカウント情報表示、認証処理
- **商品一覧** (`/products`): 在庫ステータス表示、検索フォーム、CRUD操作リンク
- **500エラーページ**: 技術的エラーメッセージ表示
- **商品登録フォーム** (`/products/new`): 入力バリデーション、ステータス固定
- **商品編集フォーム** (`/products/<id>/edit`): ステータス遷移、XSS脆弱性
- **削除処理**: 確認なし即時削除

---

## 9. エビデンス（スクリーンショット一覧）

| ファイル名 | 説明 | 主な発見 |
|-----------|------|----------|
| `step01_login_page.png` | ログインページ初期表示 | テストアカウント情報が画面上に表示 |
| `step02_products_list.png` | 商品一覧ページ | 在庫ステータス表示の色分け確認 |
| `step03_intentional_error.png` | 「バグ票」検索時のエラー画面 | 500エラー、技術的メッセージ |
| `step04_new_product_form.png` | 商品登録フォーム | ステータス「準備中」固定 |
| `step05_boundary_validation_error.png` | 境界値テスト（負の価格） | HTML5バリデーションエラー |
| `step06_stock_status_display.png` | 在庫ステータス色分け詳細 | デシジョンテーブル動作確認 |
| `step07_edit_status_preparing.png` | 商品編集画面（準備中） | ステータス遷移ルール表示 |
| `step08_xss_saved.png` | XSSスクリプト保存後 | 商品更新成功メッセージ |
| `step09_before_delete.png` | 削除前の商品一覧（全8件） | 削除ボタン配置確認 |
| `step10_after_delete.png` | 削除後の商品一覧（全7件） | 確認なし即時削除 |

---

## 10. セッション時間配分（参考）

- **0-1分**: ログイン機能テスト（正常系）
- **1-2分**: 商品一覧表示確認、在庫ステータス色分け確認
- **2-3分**: 検索機能テスト（意図的なエラー発見）
- **3-5分**: 商品登録フォーム、境界値テスト（HTML5バリデーション）
- **5-6分**: 商品編集、ステータス遷移テスト
- **6-7分**: XSS脆弱性テスト
- **7-8分**: 削除機能テスト（確認ダイアログ欠如発見）
- **8-10分**: レポート作成、スクリーンショット整理

---

## まとめと総評

本探索的テストセッションでは、10分間のタイムボックス内で、意図的に埋め込まれた3つの不具合を全て発見し、加えて複数のユーザビリティ改善点を特定できました。

**優れている点:**
- 在庫ステータス表示（デシジョンテーブル）の実装が正確
- ステータス遷移ルールが画面上で明示されており、ユーザーフレンドリー
- data-testid属性が適切に付与されており、テスト自動化が容易

**改善が必要な点:**
- 削除確認ダイアログの欠如は実務では絶対に許容できないレベル
- XSS脆弱性は悪用されるとシステム全体の信頼性を損なう
- エラーメッセージの質が低く、ユーザー体験を著しく損なう

QA経験2年目のエンジニアとして、このアプリケーションは「テスト技法の学習」という目的では非常に優れた教材ですが、本番環境では絶対に使用できないレベルの問題を複数抱えていることを認識しました。特に削除ボタンの挙動は、実務経験があるほど「これはマズい」と直感的に感じる設計であり、ユーザーの信頼を大きく損なう要因となります。

今後の追加テストでは、権限テスト、境界値テストの網羅、並行性テストなどを実施し、さらなる潜在的な問題の発見に努めることを推奨します。

---

**報告者:** QA探索的テストエージェント  
**報告日:** 2025-11-06
