# Bug #4 検証結果：誤報告でした

## 検証日
2025-11-07

## 指摘内容
@nhnmomonga さんから以下のご指摘をいただきました：

> 「重大: 商品登録フォームが送信不可」として指摘された内容ですが、確かにdisabled属性であって操作できないんですが、checked属性も付与されているので、ユーザー操作ができなくてもチェックされた状態でPOSTされると認識しています。本当に新規登録ができないかもう一度確認してもらえますか。

## 再検証結果

### 結論
**Bug #4の報告は誤りでした。商品登録は正常に機能します。**

### 検証内容

#### 1. HTMLフォームの動作確認

HTMLの仕様では、`disabled` 属性が付与された要素の値はフォーム送信時に含まれません。これは正しい理解です。

```html
<!-- templates/product_form.html:83-88 -->
<input type="radio" 
       id="status_preparing" 
       name="status" 
       value="準備中" 
       checked
       disabled>
```

`checked` と `disabled` の両方が付いていても、`disabled` の効果が優先され、この要素の値は送信されません。

#### 2. バックエンドの実装確認

しかし、バックエンドコード（`app.py` 169行目）を確認すると：

```python
status = '準備中'  # 新規登録時は常に「準備中」
```

フォームから送信される `status` フィールドの値を使用せず、**常に「準備中」をハードコード**しています。

#### 3. 実証テスト

実際に以下のテストを実施しました：

```python
# statusフィールドを含まないデータで商品登録
product_data = {
    'name': '検証テスト商品',
    'category': '家電',
    'price': '2500',
    'stock': '15',
    'description': 'disabled属性でもバックエンドで値が設定される検証'
    # 'status' フィールドは意図的に含めない
}

response = session.post(f"{BASE_URL}/products/new", data=product_data)
```

**結果**:
```
✅ 成功: 商品が登録されました
✅ 登録した商品が一覧に表示されています
✅ ステータスは「準備中」で登録されています
```

#### 4. データベース確認

```sql
SELECT id, name, status FROM products WHERE name = '検証テスト商品';
```

**結果**:
```
12|検証テスト商品|準備中
```

データベースにも正しく「準備中」として保存されています。

## なぜ誤報告したのか

### 初回テストでの誤解

探索的テスト時に、Playwrightで商品登録フォームに値を入力して「登録」ボタンをクリックしても、ページが遷移しなかったため、「フォームが送信されない」と判断しました。

しかし、これは以下のいずれかが原因だった可能性があります：
1. Playwrightのクリックイベントが正常に処理されなかった
2. JavaScriptのバリデーションやその他のフロントエンド処理が介入した
3. テスト環境の一時的な問題

### 誤った結論

`disabled` 属性の効果（値が送信されない）だけを考慮し、バックエンドの実装（statusをハードコード）を十分に確認しなかったため、誤った結論に至りました。

## 正しい理解

### フロントエンド
- `disabled` 属性により、`status` フィールドの値はフォーム送信に含まれない
- これは **正常な動作**

### バックエンド
- `status` フィールドの値を `request.form.get('status')` で取得していない
- 常に `status = '準備中'` とハードコードしている
- フォームから値が送信されなくても **問題なく動作する**

### 結果
- 商品登録は **正常に機能する**
- `disabled` 属性は意図通り動作している
- バックエンドの実装により、フォームからの値が不要

## 修正が必要なドキュメント

以下のドキュメントで Bug #4 として報告した内容を訂正する必要があります：

1. **探索的テストレポート.md**
   - Bug #4 の記載を削除または訂正
   - 「発見されたバグ」のカウントを修正（4件 → 2件）

2. **バグチケット一覧.md**
   - BUG-001 の記載を削除または訂正

3. **PR説明**
   - 「🔴 重大: 商品登録フォームが送信不可」の記載を訂正

## 謝罪と教訓

@nhnmomonga さん、ご指摘ありがとうございました。

今回の誤報告から学んだ教訓：
1. **フロントエンドの動作だけでなく、バックエンドの実装も必ず確認する**
2. **テストツールの挙動を過信せず、複数の方法で検証する**
3. **「動作しない」と報告する前に、実際のHTTPリクエスト/レスポンスを確認する**
4. **コードレビューを徹底する**

今後はより慎重にテストを実施し、報告前に十分な検証を行います。

---

**検証者**: QA自動化エージェント  
**検証日**: 2025-11-07  
**ステータス**: Bug #4 は存在しない（誤報告）
